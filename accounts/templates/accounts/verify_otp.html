{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify OTP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg); }
        .card { border-radius: 1rem; box-shadow: 0 8px 20px rgba(0,0,0,0.15); animation: fadeIn 0.5s ease-in-out; }
        .card h4 { font-weight: 600; color: #333; }
        .otp-inputs { display: flex; justify-content: space-between; }
        .otp-box {
            width: 50px; height: 60px; text-align: center; font-size: 1.5rem;
            border-radius: 0.5rem; border: 1px solid #ccc;
        }
        .otp-box:focus {
            border-color: #6e8efb; outline: none;
            box-shadow: 0 0 5px rgba(110,142,251,0.5);
        }
        .btn-custom { background: #28a745; color: #fff; font-weight: 500; border-radius: 0.5rem; transition: 0.3s; }
        .btn-custom:hover { background: #218838; }
        .resend-btn { color: #fff; background: #ff9800; border: none; padding: 6px 12px; border-radius: 0.5rem; }
        .resend-btn:disabled { background: #ccc; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4" style="max-width: 400px; width: 100%;">
        <div class="text-center mb-3">
            <img src="https://raw.githubusercontent.com/Riyas-n-s/SAMS/master/static/accounts/images/1.jpg" alt="Verify OTP" width="80">

            <h4 class="mt-2">Verify OTP</h4>
            <p class="text-muted small">We sent an OTP to <strong>{{ masked_phone }}</strong></p>
        </div>

        <!-- Show error if OTP is incorrect -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-danger text-center small py-2">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <form method="post" id="otpForm">
            {% csrf_token %}
            <div class="mb-3 otp-inputs">
                <input type="text" maxlength="1" class="otp-box" name="otp1" required>
                <input type="text" maxlength="1" class="otp-box" name="otp2" required>
                <input type="text" maxlength="1" class="otp-box" name="otp3" required>
                <input type="text" maxlength="1" class="otp-box" name="otp4" required>
                <input type="text" maxlength="1" class="otp-box" name="otp5" required>
                <input type="text" maxlength="1" class="otp-box" name="otp6" required>
            </div>
            <button type="submit" class="btn btn-custom w-100 py-2 mt-3">Verify</button>
        </form>

        <!-- Resend OTP -->
        <div class="mt-3 text-center">
            <button id="resendBtn" class="resend-btn" disabled>Resend OTP (30s)</button>
        </div>
    </div>
</div>

<script>
    // OTP input auto-focus
    const inputs = document.querySelectorAll(".otp-box");
    inputs.forEach((input, index) => {
        input.addEventListener("input", () => {
            if (input.value.length === 1 && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });
        input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && !input.value && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    // Combine OTP before submit
    document.getElementById("otpForm").addEventListener("submit", function(e) {
        let otp = "";
        inputs.forEach(input => otp += input.value);
        const hidden = document.createElement("input");
        hidden.type = "hidden";
        hidden.name = "otp";
        hidden.value = otp;
        this.appendChild(hidden);
    });

    // Countdown for resend button
    let countdown = 30;
    const resendBtn = document.getElementById("resendBtn");
    const timer = setInterval(() => {
        countdown--;
        resendBtn.innerText = `Resend OTP (${countdown}s)`;
        if (countdown <= 0) {
            clearInterval(timer);
            resendBtn.innerText = "Resend OTP";
            resendBtn.disabled = false;
            resendBtn.addEventListener("click", () => {
                window.location.href = "{% url 'send_otp' %}"; // Django URL for resend
            });
        }
    }, 1000);
</script>
</body>
</html>
