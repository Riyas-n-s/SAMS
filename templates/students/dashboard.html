{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; transition: background 0.3s, color 0.3s; background: #f8f9fa; color: #333; }
        .dark-mode { background: #121212 !important; color: #fff !important; }

        /* Sidebar */
        .sidebar { width: 250px; background: #fff; position: fixed; height: 100%; border-right: 1px solid #ddd; padding-top: 60px; transition: width 0.3s; z-index: 1000; }
        .sidebar.collapsed { width: 70px; }
        .sidebar a { display: flex; align-items: center; padding: 12px 20px; text-decoration: none; color: #333; transition: 0.3s; }
        .sidebar a i { width: 25px; }
        .sidebar a:hover { background: #e9f3ff; color: #0d6efd; }
        .sidebar.collapsed a span { display: none; }
        .dark-mode .sidebar { background: #1e1e1e; border-color: #333; }
        .dark-mode .sidebar a { color: #fff; }
        .dark-mode .sidebar a:hover { background: #333; color: #ffa500; }

        /* Topbar */
        .topbar { height: 60px; background: #fff; position: fixed; top: 0; left: 250px; right: 0; border-bottom: 1px solid #ddd; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; transition: left 0.3s; z-index: 1001; }
        .sidebar.collapsed ~ .topbar { left: 70px; }
        .dark-mode .topbar { background: #1e1e1e; border-color: #333; color: #fff; }

        /* Content */
        .content { margin-left: 250px; padding: 100px 20px 20px; transition: margin-left 0.3s; }
        .sidebar.collapsed ~ .topbar + .content { margin-left: 70px; }

        /* Profile Card */
        .profile-card { border-radius: 12px; padding: 20px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 5px solid #0d6efd; }
        .dark-mode .profile-card { background: #1e1e1e; border-left: 5px solid #ffa500; color: #fff; }

        /* Dashboard Cards */
        .dash-card { border-radius: 12px; padding: 20px; text-align: center; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s, background 0.3s; cursor: pointer; text-decoration: none; color: inherit; display: block; }
        .dash-card:hover { transform: scale(1.05); background: #e9f3ff; }
        .dash-card i { font-size: 2rem; margin-bottom: 10px; color: #0d6efd; }
        .dark-mode .dash-card { background: #1e1e1e; color: #fff; }
        .dark-mode .dash-card i { color: #ffa500; }
        .dark-mode .dash-card:hover { background: #222; }

        /* Profile Dropdown */
        .profile-dropdown { position: relative; }
        .profile-dropdown-menu { position: absolute; right: 0; top: 60px; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 10px 0; display: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .profile-dropdown-menu a { display: block; padding: 8px 20px; color: #333; text-decoration: none; }
        .profile-dropdown-menu a:hover { background: #f1f1f1; }
        .profile-dropdown.active .profile-dropdown-menu { display: block; }
        .dark-mode .profile-dropdown-menu { background: #1e1e1e; border-color: #333; }
        .dark-mode .profile-dropdown-menu a { color: #fff; }
        .dark-mode .profile-dropdown-menu a:hover { background: #333; }
    </style>
</head>
<body>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <a href="#" onclick="toggleSidebar()"><i class="fas fa-bars"></i> <span>Menu</span></a>

    <a href="{% url 'student_dashboard' %}">
        <i class="fas fa-home"></i> <span>Dashboard</span>
    </a>

    
    <a href="{% url 'student_study_materials' %}">
        <i class="fas fa-book"></i> <span>Study Materials</span>
    </a>

    <a href="{% url 'student_assignments' %}">
        <i class="fas fa-tasks"></i> <span>Assignments</span>
    </a>

    <a href="{% url 'view_attendance' %}">
        <i class="fas fa-calendar-check"></i> <span>Attendance</span>
    </a>

    <a href="{% url 'cgpa_calculator' %}">
        <i class="fas fa-chart-line"></i> <span>CGPA Calculator</span>
    </a>

    <a href="{% url 'student_chat' %}">
        <i class="fas fa-comments"></i> <span>Ask Doubt</span>
    </a>

    <a href="{% url 'check_dues' %}">
        <i class="fas fa-file-alt"></i> <span>No Dues</span>
    </a>
</div>


    <!-- Topbar -->
     
    <div class="topbar">
        <h5>Welcome, Student</h5>
        <div class="d-flex align-items-center">
            <button class="btn btn-sm btn-outline-primary me-3" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
            <div class="profile-dropdown" id="profileDropdown">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile" class="rounded-circle" style="width:40px; height:40px; cursor:pointer;" onclick="toggleProfileDropdown()">
                <div class="profile-dropdown-menu">
                   <a href="{% url 'student_profile' %}">View Profile</a>

                    
                    <a href="{% url 'logout' %}">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Profile Card -->
<div class="profile-card mb-4 d-flex align-items-center p-3 border shadow" style="border-radius: 0; max-width: 400px;">
    <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" 
         alt="Profile Picture" 
         class="rounded-circle me-3" 
         style="width:70px; height:70px; object-fit: cover;">
    <div>
        <h5 class="mb-1">{{ student.name }}</h5>
        <p class="mb-0">Branch: <strong>{{ student.branch }}</strong></p>
        <p class="mb-0">Semester: <strong>{{ student.semester }}</strong></p>
    </div>
</div>

       
   <div class="row g-3">
<div class="col-md-4">
    <a href="{% url 'student_study_materials' %}" class="dash-card" id="study-card" style="position: relative;">
        <i class="fas fa-book"></i>
        <h6>Study Materials</h6>
        <!-- Badge -->
        <span id="study-badge" 
              class="badge bg-danger rounded-pill" 
              style="position: absolute; top: 8px; right: 10px; font-size: 0.75rem; display: none;">
        </span>
    </a>
</div>




    <div class="col-md-4">
    <a href="{% url 'student_assignments' %}" class="dash-card" id="assignment-card" style="position: relative;">
        <i class="fas fa-file-upload"></i>
        <h6>Assignments</h6>
        <!-- Badge -->
        <span id="assignment-card-badge" 
              class="badge bg-danger rounded-pill" 
              style="position: absolute; top: 8px; right: 10px; font-size: 0.75rem; display: none;">
        </span>
    </a>
</div>


    <div class="col-md-4">
        <a href="{% url 'view_attendance' %}" class="dash-card">
            <i class="fas fa-calendar-check"></i>
            <h6>Attendance</h6>
        </a>
    </div>

    <div class="col-md-4">
        <a href="{% url 'cgpa_calculator' %}" class="dash-card">
            <i class="fas fa-chart-line"></i>
            <h6>CGPA Calculator</h6>
        </a>
    </div>

    <div class="col-md-4">
    <a href="{% url 'student_chat' %}" class="dash-card" id="chat-card" style="position: relative;">
        <i class="fas fa-comments"></i>
        <h6>Doubts & Chat</h6>
        <!-- Badge -->
        <span id="chat-badge" 
              class="badge bg-danger rounded-pill" 
              style="position: absolute; top: 8px; right: 10px; font-size: 0.75rem; display: none;">
        </span>
    </a>
</div>


    <div class="col-md-4">
    <a href="{% url 'check_dues' %}" class="dash-card" id="dues-card" style="position: relative;">
        <i class="fas fa-file-alt"></i>
        <h6>No Dues</h6>
        <!-- Badge -->
        <span id="dues-badge"
              class="badge bg-danger rounded-pill"
              style="position: absolute; top: 8px; right: 10px; font-size: 0.75rem; display: none;">
        </span>
    </a>
</div>

</div>

<script>
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('collapsed');
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        // Save preference to localStorage
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function toggleProfileDropdown() {
        document.getElementById('profileDropdown').classList.toggle('active');
    }

    // Close dropdown if clicked outside
    document.addEventListener('click', function(e) {
        if (!document.getElementById('profileDropdown').contains(e.target)) {
            document.getElementById('profileDropdown').classList.remove('active');
        }
    });

    // Apply saved dark mode preference on page load
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
    }
    
function updateAssignmentBadge() {
    fetch('{% url "student_unseen_assignments" %}')
    .then(res => res.json())
    .then(data => {
        const badge = document.getElementById('assignment-card-badge');
        if(data.unseen_count > 0){
            badge.textContent = data.unseen_count;
            badge.style.display = 'inline-block';
        } else {
            badge.style.display = 'none';
        }
    });
}

// Run on page load
updateAssignmentBadge();

// Refresh every 3 seconds
setInterval(updateAssignmentBadge, 3000);


function updateStudyBadge() {
    fetch('{% url "student_unseen_materials" %}')
    .then(res => res.json())
    .then(data => {
        const badge = document.getElementById('study-badge');
        if (data.unseen_count > 0) {
            badge.style.display = 'inline-block';
            badge.textContent = data.unseen_count;
        } else {
            badge.style.display = 'none';
        }
    });
}

// Run every 3 seconds
setInterval(updateStudyBadge, 3000);
updateStudyBadge(); // initial call


function updateChatBadge() {
    fetch('{% url "student_unread_doubts" %}')
    .then(res => res.json())
    .then(data => {
        const badge = document.getElementById('chat-badge');
        if (data.unread_count > 0) {
            badge.textContent = data.unread_count;
            badge.style.display = 'inline-block';
        } else {
            badge.style.display = 'none';
        }
    });
}

updateChatBadge();
setInterval(updateChatBadge, 3000);



document.addEventListener('DOMContentLoaded', function() {
    function updateChatBadge() {
        fetch('{% url "student_unread_doubts" %}')
        .then(res => res.json())
        .then(data => {
            const badge = document.getElementById('chat-badge');
            if (data.unread_count > 0) {
                badge.textContent = data.unread_count;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        });
    }

    updateChatBadge(); // initial call
    setInterval(updateChatBadge, 3000); // refresh every 3 sec
});


function updateDuesBadge() {
    fetch('{% url "student_unseen_dues" %}')
    .then(res => res.json())
    .then(data => {
        const badge = document.getElementById('dues-badge');
        if(data.unseen_count > 0){
            badge.textContent = data.unseen_count;
            badge.style.display = 'inline-block';
        } else {
            badge.style.display = 'none';
        }
    });
}

// Run on page load
updateDuesBadge();

// Refresh every 3 seconds
setInterval(updateDuesBadge, 3000);


</script>


</body>
</html>
