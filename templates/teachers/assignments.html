{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Teacher Dashboard - Assignments</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <style>
        body { background: #f8f9fa; font-size: 0.9rem; }
        .card { border-radius: 10px; padding: 15px; }
        .form-control, .form-select { height: 38px; font-size: 0.9rem; }
        .btn { font-size: 0.85rem; padding: 6px 12px; }
        .list-group-item { padding: 10px 12px; }
    </style>
</head>
<body>
<div class="d-flex justify-content-between align-items-center p-2 bg-light border-bottom">
    <a href="{% url 'teacher-dashboard' %}" class="btn btn-outline-secondary btn-sm">
        <i class="fa fa-arrow-left"></i> Back
    </a>
    <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">
        <i class="fa fa-sign-out-alt"></i> Logout
    </a>
</div>

<div class="container mt-4">
    <h4 class="mb-3 text-primary"><i class="fa fa-tasks"></i> Teacher - Assignments</h4>

    <!-- Post Assignment -->
    <div class="card shadow-sm mb-3">
        <h6 class="fw-bold mb-2"><i class="fa fa-plus-circle"></i> Post New Assignment</h6>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row g-2">
                <div class="col-md-4">
                    <select name="subject" class="form-select" required>
                        <option value="">Select Subject</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="date" name="due_date" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <input type="text" name="title" class="form-control" placeholder="Title" required>
                </div>
                <div class="col-md-8">
                    <textarea name="description" class="form-control" rows="2" placeholder="Description (optional)"></textarea>
                </div>
                <div class="col-md-4">
                    <input type="file" name="file" class="form-control" required>
                </div>
            </div>
            <div class="mt-2 text-end">
                <button type="submit" class="btn btn-success btn-sm"><i class="fa fa-upload"></i> Post</button>
            </div>
        </form>
    </div>

    <!-- List Assignments -->
    <div class="card shadow-sm">
        <h6 class="fw-bold mb-2"><i class="fa fa-list"></i> My Assignments</h6>
        <ul class="list-group">
            {% for assignment in assignments %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ assignment.title }}</strong>
                    <span class="badge bg-info ms-1">{{ assignment.subject.name }}</span>
                    <br>
                    <small class="{% if assignment.due_date < today %}text-danger{% else %}text-success{% endif %}">
                        Due: {{ assignment.due_date }}
                    </small>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'view_submissions' assignment.id %}" class="btn btn-primary btn-sm">
                        <i class="fa fa-eye"></i> View
                    </a>
                    <form method="POST" action="{% url 'delete_assignment' assignment.id %}" class="delete-assignment-form">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="fa fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </li>
            {% empty %}
            <li class="list-group-item text-muted text-center">No assignments posted.</li>
            {% endfor %}
        </ul>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- SweetAlert for single message -->
{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const message = '{{ messages.0|escapejs }}';
    const tag = '{{ messages.0.tags }}';

    if (message) {
        Swal.fire({
            icon: tag === "success" ? "success" :
                  tag === "error" ? "error" :
                  tag === "warning" ? "warning" : "info",
            title: tag.charAt(0).toUpperCase() + tag.slice(1),
            text: message,
            timer: 2000,
            timerProgressBar: true,
            showConfirmButton: false,
        });
    }
});
</script>
{% endif %}

<!-- Delete confirmation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteForms = document.querySelectorAll('form.delete-assignment-form');
    deleteForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    });
});
</script>

</body>
</html>
